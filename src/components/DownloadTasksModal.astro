---
// Download Tasks Modal Component
export interface Props {
  appSlug?: string;
}

const { appSlug } = Astro.props;
---

<div id="download-tasks-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden items-center justify-center z-50" aria-modal="true" aria-labelledby="download-tasks-title">
  <input type="hidden" id="modal-app-slug" value={appSlug} />
  <div class="bg-white dark:bg-gray-800 rounded-3xl p-8 max-w-md w-full mx-4 relative overflow-hidden">
    <!-- Close Button -->
    <button 
      id="close-download-tasks" 
      class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors duration-200 p-2 rounded-full"
      aria-label="Close download tasks"
    >
      <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    requestAnimationFrame(() => {
      modal.classList.remove('hidden');
      modal.classList.add('flex');
    });
    </button>
    
    <!-- Modal Content -->
    <div class="text-center">
      <!-- Celebration Icon -->
      <div class="w-20 h-20 bg-green-50 dark:bg-green-900/20 rounded-full flex items-center justify-center mx-auto mb-6">
        <svg class="w-10 h-10 text-green-500 dark:text-green-400" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
        </svg>
      </div>
      
      <!-- Title -->
      <h2 id="download-tasks-title" class="text-2xl font-bold text-gray-900 dark:text-white mb-4">
        Almost Done!
      </h2>
      
      <!-- Description -->
      <p class="text-gray-700 dark:text-gray-300 mb-6">
        Complete these quick tasks to unlock your download
      </p>
      
      <!-- Progress Bar -->
      <div class="h-2 bg-gray-200 dark:bg-gray-700 rounded-full mb-4 overflow-hidden">
        <div id="tasks-progress-bar" class="h-full bg-green-500 rounded-full w-0 transition-all duration-300"></div>
      </div>
      
      <!-- Progress Text -->
      <p id="tasks-progress-text" class="text-gray-600 dark:text-gray-400 mb-6">
        0 of 0 tasks completed
      </p>
      
      <!-- Tasks List -->
      <div id="download-tasks-list" class="space-y-4 mb-6">
        <!-- Tasks will be loaded here dynamically -->
        <div class="flex items-center justify-center py-8">
          <div class="animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full"></div>
        </div>
      </div>
      
      <!-- Download Button -->
      <button
        id="download-now-btn"
        class="w-full py-4 px-6 bg-gray-200 dark:bg-gray-700 text-gray-400 dark:text-gray-500 rounded-xl font-medium transition-all duration-300 cursor-not-allowed"
        disabled
      >
        Download Now
      </button>
    </div>
  </div>
</div>

<script>
  // Defer loading of non-critical script
  document.addEventListener('DOMContentLoaded', function() {
    const script = document.createElement('script');
    script.src = '../components/downloadTasksModalScript.js?v=1.5';
    script.defer = true;
    document.body.appendChild(script);
  });
</script>

<style>
  /* Ensure the modal is accessible */
  #download-tasks-modal[aria-hidden="true"],
  #download-tasks-modal.hidden {
    display: none;
  }
  
  /* Smooth transitions */
  .transition-all {
    transition-property: transform, opacity;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    transition-duration: 300ms;
  }
  
  /* Screen reader only content */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
      });
  @media (prefers-reduced-motion: reduce) {
    .transition-all,
    #tasks-progress-bar {
      transition: none;
    }
  }
</style>