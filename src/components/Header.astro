---
// Header component with sidebar menu integration
import Logo from './Logo.astro';

---

<header class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700 sticky top-0 z-50">
  <div class="max-w-7xl mx-auto px-3 sm:px-6 lg:px-8">
    <div class="relative flex items-center h-20 sm:h-24 overflow-hidden">
      
      <!-- Mobile Menu Button - Positioned absolutely to left -->
      <div class="absolute left-0 md:hidden z-10">
        <button 
          id="mobile-menu-button"
          class="inline-flex items-center justify-center p-2 rounded-md text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500 transition-colors duration-200 min-w-[44px] min-h-[44px]"
          aria-controls="sidebar-menu"
          aria-expanded="false"
          aria-label="Toggle navigation menu"
        >
          <span class="sr-only">Open main menu</span>
          <!-- Hamburger Icon -->
          <svg class="h-5 w-5 sm:h-6 sm:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </div>

      <!-- Logo Container - Properly Constrained -->
      <div class="absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 z-10">
        <a 
          href="/" 
          class="flex items-center justify-center group focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 rounded-lg p-2 min-w-[44px] min-h-[44px] max-w-[200px] max-h-[60px] overflow-hidden"
          style="
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: auto;
            height: auto;
            max-width: 200px;
            max-height: 60px;
            clip-path: inset(0);
          "
        >
          <div class="relative w-auto h-auto max-w-full max-h-full">
            <Logo size="2xl" showText={false} />
          </div>
        </a>
      </div>

      <!-- Desktop Navigation - Hidden on mobile, positioned to not interfere with logo -->
      <nav class="hidden md:flex space-x-6 lg:space-x-8 absolute left-4 z-10" aria-label="Main navigation">
        <a href="/" class="text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 px-3 py-2 rounded-md text-sm font-medium transition-colors duration-200 min-w-[44px] min-h-[44px] flex items-center justify-center">
          Home
        </a>
        <a href="/categories" class="text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 px-3 py-2 rounded-md text-sm font-medium transition-colors duration-200 min-w-[44px] min-h-[44px] flex items-center justify-center">
          Categories
        </a>
        <a href="/trending" class="text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 px-3 py-2 rounded-md text-sm font-medium transition-colors duration-200 min-w-[44px] min-h-[44px] flex items-center justify-center">
          Trending
        </a>
        <a href="/about" class="text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 px-3 py-2 rounded-md text-sm font-medium transition-colors duration-200 min-w-[44px] min-h-[44px] flex items-center justify-center">
          About
        </a>
      </nav>

      <!-- Right Side Controls - Positioned absolutely to right -->
      <div class="absolute right-0 flex items-center space-x-2 sm:space-x-4 z-10">
        
        <!-- Search Button -->
        <a 
          href="/search"
          class="inline-flex items-center justify-center p-2 rounded-md text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500 transition-colors duration-200 min-w-[44px] min-h-[44px]"
          aria-label="Search APKs"
        >
          <span class="sr-only">Search</span>
          <svg class="h-4 w-4 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
          </svg>
        </a>

        <!-- Theme Toggle -->
        <button 
          id="theme-toggle"
          class="inline-flex items-center justify-center p-2 rounded-md text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500 transition-colors duration-200 min-w-[44px] min-h-[44px]"
          aria-label="Toggle dark mode"
        >
          <span class="sr-only">Toggle theme</span>
          <!-- Sun Icon (visible in dark mode) -->
          <svg class="w-4 h-4 sm:h-5 sm:w-5 hidden dark:block" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
          </svg>
          <!-- Moon Icon (visible in light mode) -->
          <svg class="w-4 h-4 sm:h-5 sm:w-5 dark:hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
          </svg>
        </button>
      </div>
    </div>
  </div>
</header>

<!-- Sidebar Menu Overlay -->
<div 
  id="sidebar-overlay" 
  class="fixed inset-0 bg-black/50 backdrop-blur-sm z-40 opacity-0 invisible transition-all duration-300 ease-in-out"
  aria-hidden="true"
></div>

<!-- Sidebar Menu -->
<aside 
  id="sidebar-menu"
  class="fixed top-0 left-0 h-full w-80 bg-white dark:bg-gray-800 shadow-2xl z-50 transform -translate-x-full transition-transform duration-300 ease-in-out"
  role="navigation"
  aria-label="Main navigation menu"
>
  <!-- Sidebar Header -->
  <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700">
    <div class="flex items-center space-x-3">
      <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl flex items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
        </svg>
      </div>
      <div>
        <h2 class="text-lg font-bold text-gray-900 dark:text-white">DexAPK</h2>
        <p class="text-sm text-gray-500 dark:text-gray-400">Navigation Menu</p>
      </div>
    </div>
    <button 
      id="sidebar-close"
      class="inline-flex items-center justify-center p-2 rounded-lg text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-200 min-w-[44px] min-h-[44px]"
      aria-label="Close navigation menu"
    >
      <span class="sr-only">Close menu</span>
      <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
      </svg>
    </button>
  </div>

  <!-- Navigation Links -->
  <nav class="flex-1 px-6 py-6" aria-label="Sidebar navigation">
    <ul class="space-y-2" role="list">
      
      <!-- Home -->
      <li>
        <a 
          href="/" 
          class="sidebar-link group flex items-center px-4 py-3 text-base font-medium text-gray-700 dark:text-gray-300 rounded-xl hover:bg-blue-50 dark:hover:bg-blue-900/20 hover:text-blue-600 dark:hover:text-blue-400 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 min-h-[44px]"
          role="menuitem"
          tabindex="0"
        >
          <div class="flex items-center justify-center w-10 h-10 bg-gray-100 dark:bg-gray-700 rounded-lg mr-4 group-hover:bg-blue-100 dark:group-hover:bg-blue-800 transition-colors duration-200">
            <svg class="w-5 h-5 text-gray-600 dark:text-gray-400 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m0 0h3m0 0h3a1 1 0 001-1V10M9 21v-6a1 1 0 011-1h2a1 1 0 011 1v6"/>
            </svg>
          </div>
          <div class="flex-1">
            <span class="block font-semibold">Home</span>
            <span class="block text-sm text-gray-500 dark:text-gray-400 group-hover:text-blue-500 dark:group-hover:text-blue-300 transition-colors duration-200">Latest MOD APKs</span>
          </div>
          <svg class="w-5 h-5 text-gray-400 group-hover:text-blue-500 dark:group-hover:text-blue-400 transition-colors duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        </a>
      </li>

      <!-- Categories -->
      <li>
        <a 
          href="/categories" 
          class="sidebar-link group flex items-center px-4 py-3 text-base font-medium text-gray-700 dark:text-gray-300 rounded-xl hover:bg-purple-50 dark:hover:bg-purple-900/20 hover:text-purple-600 dark:hover:text-purple-400 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 min-h-[44px]"
          role="menuitem"
          tabindex="0"
        >
          <div class="flex items-center justify-center w-10 h-10 bg-gray-100 dark:bg-gray-700 rounded-lg mr-4 group-hover:bg-purple-100 dark:group-hover:bg-purple-800 transition-colors duration-200">
            <svg class="w-5 h-5 text-gray-600 dark:text-gray-400 group-hover:text-purple-600 dark:group-hover:text-purple-400 transition-colors duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
            </svg>
          </div>
          <div class="flex-1">
            <span class="block font-semibold">Categories</span>
            <span class="block text-sm text-gray-500 dark:text-gray-400 group-hover:text-purple-500 dark:group-hover:text-purple-300 transition-colors duration-200">Browse by type</span>
          </div>
          <svg class="w-5 h-5 text-gray-400 group-hover:text-purple-500 dark:group-hover:text-purple-400 transition-colors duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        </a>
      </li>

      <!-- Trending -->
      <li>
        <a 
          href="/trending" 
          class="sidebar-link group flex items-center px-4 py-3 text-base font-medium text-gray-700 dark:text-gray-300 rounded-xl hover:bg-red-50 dark:hover:bg-red-900/20 hover:text-red-600 dark:hover:text-red-400 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 min-h-[44px]"
          role="menuitem"
          tabindex="0"
        >
          <div class="flex items-center justify-center w-10 h-10 bg-gray-100 dark:bg-gray-700 rounded-lg mr-4 group-hover:bg-red-100 dark:group-hover:bg-red-800 transition-colors duration-200">
            <svg class="w-5 h-5 text-gray-600 dark:text-gray-400 group-hover:text-red-600 dark:group-hover:text-red-400 transition-colors duration-200" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M13 10V3L4 14h7v7l9-11h-7z"/>
            </svg>
          </div>
          <div class="flex-1">
            <span class="block font-semibold">Trending</span>
            <span class="block text-sm text-gray-500 dark:text-gray-400 group-hover:text-red-500 dark:group-hover:text-red-300 transition-colors duration-200">Hot & popular</span>
          </div>
          <div class="flex items-center">
            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200 mr-2">
              ðŸ”¥ Hot
            </span>
            <svg class="w-5 h-5 text-gray-400 group-hover:text-red-500 dark:group-hover:text-red-400 transition-colors duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </div>
        </a>
      </li>

      <!-- About -->
      <li>
        <a 
          href="/about" 
          class="sidebar-link group flex items-center px-4 py-3 text-base font-medium text-gray-700 dark:text-gray-300 rounded-xl hover:bg-green-50 dark:hover:bg-green-900/20 hover:text-green-600 dark:hover:text-green-400 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 min-h-[44px]"
          role="menuitem"
          tabindex="0"
        >
          <div class="flex items-center justify-center w-10 h-10 bg-gray-100 dark:bg-gray-700 rounded-lg mr-4 group-hover:bg-green-100 dark:group-hover:bg-green-800 transition-colors duration-200">
            <svg class="w-5 h-5 text-gray-600 dark:text-gray-400 group-hover:text-green-600 dark:group-hover:text-green-400 transition-colors duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
          </div>
          <div class="flex-1">
            <span class="block font-semibold">About</span>
            <span class="block text-sm text-gray-500 dark:text-gray-400 group-hover:text-green-500 dark:group-hover:text-green-300 transition-colors duration-200">Learn more</span>
          </div>
          <svg class="w-5 h-5 text-gray-400 group-hover:text-green-500 dark:group-hover:text-green-400 transition-colors duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        </a>
      </li>

    </ul>
  </nav>

  <!-- Sidebar Footer -->
  <div class="px-6 py-4 border-t border-gray-200 dark:border-gray-700">
    <div class="flex items-center justify-between">
      <div class="flex items-center space-x-3">
        <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
          <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
          </svg>
        </div>
        <div>
          <p class="text-sm font-medium text-gray-900 dark:text-white">DexAPK</p>
          <p class="text-xs text-gray-500 dark:text-gray-400">Premium MOD APKs</p>
        </div>
      </div>
      <button 
        id="sidebar-theme-toggle"
        class="inline-flex items-center justify-center p-2 rounded-lg text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-200 min-w-[44px] min-h-[44px]"
        aria-label="Toggle dark mode"
      >
        <span class="sr-only">Toggle theme</span>
        <!-- Sun Icon (visible in dark mode) -->
        <svg class="w-5 h-5 hidden dark:block" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
        </svg>
        <!-- Moon Icon (visible in light mode) -->
        <svg class="w-5 h-5 dark:hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
        </svg>
      </button>
    </div>
  </div>
</aside>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const sidebarMenu = document.getElementById('sidebar-menu');
    const sidebarOverlay = document.getElementById('sidebar-overlay');
    const sidebarClose = document.getElementById('sidebar-close');
    const themeToggle = document.getElementById('theme-toggle');
    const sidebarThemeToggle = document.getElementById('sidebar-theme-toggle');
    const sidebarLinks = document.querySelectorAll('.sidebar-link');

    let isOpen = false;
    let focusableElements = [];

    // Initialize focusable elements
    function updateFocusableElements() {
      focusableElements = Array.from(sidebarMenu.querySelectorAll(
        'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
      ));
    }

    // Open sidebar
    function openSidebar() {
      isOpen = true;
      
      // Update ARIA attributes
      mobileMenuButton.setAttribute('aria-expanded', 'true');
      sidebarMenu.setAttribute('aria-hidden', 'false');
      sidebarOverlay.setAttribute('aria-hidden', 'false');
      
      // Show overlay with blur effect
      sidebarOverlay.classList.remove('opacity-0', 'invisible');
      sidebarOverlay.classList.add('opacity-100', 'visible');
      
      // Slide in sidebar
      sidebarMenu.classList.remove('-translate-x-full');
      sidebarMenu.classList.add('translate-x-0');
      
      // Prevent body scroll
      document.body.style.overflow = 'hidden';
      
      // Update focusable elements and focus first link
      updateFocusableElements();
      if (focusableElements.length > 0) {
        // Focus the close button first for better UX
        sidebarClose.focus();
      }
      
      // Announce to screen readers
      announceToScreenReader('Navigation menu opened');
    }

    // Close sidebar
    function closeSidebar() {
      isOpen = false;
      
      // Update ARIA attributes
      mobileMenuButton.setAttribute('aria-expanded', 'false');
      sidebarMenu.setAttribute('aria-hidden', 'false');
      sidebarOverlay.setAttribute('aria-hidden', 'true');
      
      // Hide overlay
      sidebarOverlay.classList.remove('opacity-100', 'visible');
      sidebarOverlay.classList.add('opacity-0', 'invisible');
      
      // Slide out sidebar
      sidebarMenu.classList.remove('translate-x-0');
      sidebarMenu.classList.add('-translate-x-full');
      
      // Restore body scroll
      document.body.style.overflow = '';
      
      // Return focus to menu button
      mobileMenuButton.focus();
      
      // Announce to screen readers
      announceToScreenReader('Navigation menu closed');
    }

    // Toggle sidebar
    function toggleSidebar() {
      if (isOpen) {
        closeSidebar();
      } else {
        openSidebar();
      }
    }

    // Event listeners
    mobileMenuButton?.addEventListener('click', toggleSidebar);
    sidebarClose?.addEventListener('click', closeSidebar);
    sidebarOverlay?.addEventListener('click', closeSidebar);

    // Theme toggle functionality
    function toggleTheme() {
      document.documentElement.classList.toggle('dark');
      
      // Announce theme change
      const isDark = document.documentElement.classList.contains('dark');
      announceToScreenReader(`Switched to ${isDark ? 'dark' : 'light'} mode`);
    }

    themeToggle?.addEventListener('click', toggleTheme);
    sidebarThemeToggle?.addEventListener('click', toggleTheme);

    // Keyboard navigation
    document.addEventListener('keydown', function(e) {
      if (!isOpen) return;

      switch(e.key) {
        case 'Escape':
          e.preventDefault();
          closeSidebar();
          break;
          
        case 'Tab':
          // Trap focus within sidebar
          if (focusableElements.length === 0) return;
          
          const firstElement = focusableElements[0];
          const lastElement = focusableElements[focusableElements.length - 1];
          
          if (e.shiftKey) {
            // Shift + Tab
            if (document.activeElement === firstElement) {
              e.preventDefault();
              lastElement.focus();
            }
          } else {
            // Tab
            if (document.activeElement === lastElement) {
              e.preventDefault();
              firstElement.focus();
            }
          }
          break;
          
        case 'ArrowDown':
          // Navigate down through sidebar links
          e.preventDefault();
          navigateSidebarLinks('down');
          break;
          
        case 'ArrowUp':
          // Navigate up through sidebar links
          e.preventDefault();
          navigateSidebarLinks('up');
          break;
          
        case 'Home':
          // Focus first sidebar link
          e.preventDefault();
          if (sidebarLinks.length > 0) {
            sidebarLinks[0].focus();
          }
          break;
          
        case 'End':
          // Focus last sidebar link
          e.preventDefault();
          if (sidebarLinks.length > 0) {
            sidebarLinks[sidebarLinks.length - 1].focus();
          }
          break;
      }
    });

    // Navigate through sidebar links with arrow keys
    function navigateSidebarLinks(direction) {
      const currentIndex = Array.from(sidebarLinks).indexOf(document.activeElement);
      if (currentIndex === -1) return;
      
      let nextIndex;
      if (direction === 'down') {
        nextIndex = currentIndex + 1 >= sidebarLinks.length ? 0 : currentIndex + 1;
      } else {
        nextIndex = currentIndex - 1 < 0 ? sidebarLinks.length - 1 : currentIndex - 1;
      }
      
      sidebarLinks[nextIndex].focus();
    }

    // Close sidebar when clicking on links (for mobile)
    sidebarLinks.forEach(link => {
      link.addEventListener('click', () => {
        // Small delay to allow navigation to start
        setTimeout(closeSidebar, 100);
      });
    });

    // Handle window resize
    window.addEventListener('resize', function() {
      if (window.innerWidth >= 768 && isOpen) {
        // Close sidebar on desktop breakpoint
        closeSidebar();
      }
    });

    // Screen reader announcements
    function announceToScreenReader(message) {
      const announcement = document.createElement('div');
      announcement.setAttribute('aria-live', 'polite');
      announcement.setAttribute('aria-atomic', 'true');
      announcement.className = 'sr-only';
      announcement.textContent = message;
      
      document.body.appendChild(announcement);
      
      setTimeout(() => {
        document.body.removeChild(announcement);
      }, 1000);
    }

    // Initialize
    updateFocusableElements();
  });
</script>

<style>
  /* Constrain logo link to proper boundaries */
  header {
    position: sticky;
    contain: layout paint style;
  }
  
  /* Prevent any overflow from extending clickable areas */
  header > div {
    position: relative;
    overflow: hidden;
  }
  
  /* Constrain logo link to proper boundaries */
  header a[href="/"] {
    position: relative;
    display: inline-flex;
    max-width: 200px;
    max-height: 60px;
    overflow: hidden;
    contain: layout style;
  }
  
  /* Sidebar animations */
  #sidebar-menu {
    will-change: transform;
    contain: layout paint;
  }
  
  #sidebar-overlay {
    will-change: opacity;
    contain: layout paint;
  }
  
  /* Enhanced focus styles for sidebar */
  .sidebar-link:focus {
    outline: 2px solid #3b82f6;
    outline-offset: 2px;
  }
  
  /* Smooth transitions */
  .sidebar-link {
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  /* Screen reader only content */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }
  
  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    #sidebar-menu,
    #sidebar-overlay,
    .sidebar-link {
      transition: none !important;
      animation: none !important;
    }
  }
  
  /* Additional containment for mobile */
  @media (max-width: 768px) {
    header a[href="/"] {
      max-width: 150px;
      max-height: 50px;
    }
    
    #sidebar-menu {
      width: 100vw;
      max-width: 320px;
    }
  }
  
  /* High contrast mode support */
  @media (prefers-contrast: high) {
    .sidebar-link {
      border: 1px solid currentColor;
    }
    
    .sidebar-link:hover,
    .sidebar-link:focus {
      background-color: highlight;
      color: highlighttext;
    }
  }
</style>